#!/bin/bash
######################################################################
# Horms                                                   October 2004
######################################################################

if [ "$LIBTKB_GENERIC" != "YES" ]; then
LIBTKB_GENERIC="YES"

declare VERSION BRANCH START_STAGE END_STAGE STAGE MAJOR_MINOR SVN_SUBDIR
pre_conf_setup_generic ()
{
	if ! which fakeroot >& /dev/null; then
		echo "Error: fakeroot is not installed" 1>&2
		exit 1
	fi

	if [ $# -lt 2 -o $# -gt 4 ]; then
		usage
	fi
	VERSION="$1"
	BRANCH="$2"
	
	if [ $# -gt 2 ]; then
		START_STAGE=$3
	else
		START_STAGE=0
	fi
	if [ $# -gt 3 ]; then
		END_STAGE=$4
	else
		END_STAGE=1000
	fi
	STAGE=0

	case $BRANCH in
		sarge|stable)
			SVN_BASE="$SVN_BASE_SARGE"
		;;
		sarge-security|stable-security)
			SVN_BASE="$SVN_BASE_SARGE_SECURITY"
		;;
		sid|etch|unstable|testing)
			SVN_BASE="$SVN_BASE_SID"
		;;
		trunk|experimental)
			SVN_BASE="$SVN_BASE_TRUNK"
		;;
		*)
			echo "Unknown Branch" 1>&2
			usage
		;;
	esac

	case $VERSION in
		2.6)
			MAJOR_MINOR="2.6"
			SVN_SUBDIR="$SVN_SUBDIR_2_6"
		;;
		2.6.[0-9]*)
			MAJOR_MINOR="2.6"
			SVN_SUBDIR="$SVN_SUBDIR_2_6_UNUNIFIED"
		;;
		2.4.[0-9]*)
			MAJOR_MINOR="2.4"
			SVN_SUBDIR="$SVN_SUBDIR_2_4"
		;;
		*)
			echo "Unknown Version" 1>&2
			usage
		;;
	esac
}

post_conf_setup_generic ()
{
	trap pm_quit EXIT
	trap pm_quit SIGHUP
	trap pm_quit SIGTERM
	trap pm_quit SIGQUIT

	if [ ! -d "$SVN_BASE/$SVN_SUBDIR" ]; then
		echo "Error: $SVN_BASE/$SVN_SUBDIR does not seem to exist" 1>&2
		echo "Error: $VERSION $BRANCH does not seem to exist" 1>&2
		exit 1
	fi
}

fi # LIBTKB_GENERIC
