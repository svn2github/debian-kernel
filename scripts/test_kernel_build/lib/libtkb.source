#!/bin/bash
######################################################################
# Horms                                                   October 2004
######################################################################

if [ "$LIBTKB_SOURCE" != "YES" ]; then
LIBTKB_SOURCE="YES"

. "$TKB_LIB_DIR/libtkb.generic"

declare TAG_VERSION S_DEB_VERSION S_TAG_VERSION
post_conf_setup_source ()
{
	post_conf_setup_generic

	if [ -z "$TAG_VERSION" ]; then
		if [ -s "$TAG_RELEASE" ]; then
			TAG_VERSION="${TAG_DATE}00"
		else
			TAG_VERSION="${TAG_RELEASE}.${TAG_DATE}00"
		fi
	fi

	S_DEB_VERSION=$(deb_version "$S_SRC_DIR")
	S_TAG_VERSION=$(tag_version "$S_SRC_DIR")
	S_UPSTREAM_VERSION=$(upstream_version "$S_SRC_DIR")

	log "Building as $(whoami)@$(hostname) (this will be included in dmsg)";
	if [ -n "$RELEASE" ]; then
		log "Building: release packages"
		log "Building: kernel-source $S_DEB_VERSION"
	else
		log "Building: test packages"
		log "          Define RELEASE=yes in the environment to build for a release"
		log "Building: TAG_VERSION=\"$TAG_VERSION\", override in environment"
		log "Building: kernel-source $S_DEB_VERSION -> $S_TAG_VERSION"
	fi
}

fi # LIBTKB_SOURCE
