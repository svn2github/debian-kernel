#!/bin/sh

set -e

kbpkg=@kbpkg@

cd $DEBIAN_SRCTOP
{
	find . -path './scripts/*' -prune -o \
		-path './Documentation/*' -prune -o \
		-path './debian/*' -prune -o \
		-type f \( -name Makefile -o -name 'Kconfig*' \) -print
	echo arch/$DEB_HOST_ARCH/kernel/asm-offsets.s
	echo arch/$DEB_HOST_ARCH/module.lds
	find arch/$DEB_HOST_ARCH/scripts -not -name unwcheck.py
} | cpio -pd --preserve-modification-time $OLDPWD
cd - > /dev/null
ln -s ../$kbpkg/scripts .

remove=
cd include
for i in asm-*; do
	case ${i#asm-} in
	generic | $DEB_HOST_ARCH)
		;;
	*)
		remove="$remove $i"
		;;
	esac
done
${remove:+rm -r $remove}
