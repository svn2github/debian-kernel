From 6eb780fe50039fc81af6aaf8f91a38488a3cdae9 Mon Sep 17 00:00:00 2001
From: Ben Hutchings <ben@decadent.org.uk>
Date: Thu, 9 Jul 2009 00:20:59 +0100
Subject: [PATCH 1/3] cxgb3: Add #ifdef markers around firmware and mark broken

---
 drivers/net/Kconfig         |    1 +
 drivers/net/cxgb3/ael1002.c |    6 ++++++
 2 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/net/Kconfig b/drivers/net/Kconfig
index c155bd3..183479d 100644
--- a/drivers/net/Kconfig
+++ b/drivers/net/Kconfig
@@ -2511,6 +2511,7 @@ config CHELSIO_T3_DEPENDS
 
 config CHELSIO_T3
 	tristate "Chelsio Communications T3 10Gb Ethernet support"
+	depends on BROKEN
 	depends on CHELSIO_T3_DEPENDS
 	select FW_LOADER
 	select MDIO
diff --git a/drivers/net/cxgb3/ael1002.c b/drivers/net/cxgb3/ael1002.c
index 9fe008e..d53cec4 100644
--- a/drivers/net/cxgb3/ael1002.c
+++ b/drivers/net/cxgb3/ael1002.c
@@ -304,6 +304,7 @@ static int ael2005_setup_sr_edc(struct cphy *phy)
 		{ MDIO_MMD_PMAPMD, 0xc04a, 0xffff, 0x5200 },
 		{ 0, 0, 0, 0 }
 	};
+#ifdef REMOVE_DFSG
 	static u16 sr_edc[] = {
 		0xcc00, 0x2ff4,
 		0xcc01, 0x3cd4,
@@ -577,6 +578,7 @@ static int ael2005_setup_sr_edc(struct cphy *phy)
 		0xcd0d, 0x1002,
 		0xcd0e, 0
 	};
+#endif /* REMOVE_DFSG */
 	int i, err;
 
 	err = set_phy_regs(phy, regs);
@@ -604,6 +606,7 @@ static int ael2005_setup_twinax_edc(struct cphy *phy, int modtype)
 		{ MDIO_MMD_PMAPMD, 0xc015, 0xffff, 0xa000 },
 		{ 0, 0, 0, 0 }
 	};
+#ifdef REMOVE_DFSG
 	static u16 twinax_edc[] = {
 		0xcc00, 0x4009,
 		0xcc01, 0x27ff,
@@ -972,6 +975,7 @@ static int ael2005_setup_twinax_edc(struct cphy *phy, int modtype)
 		0xcd6c, 0x1002,
 		0xcd6d, 0
 	};
+#endif /* REMOVE_DFSG */
 	int i, err;
 
 	err = set_phy_regs(phy, regs);
@@ -1202,6 +1206,7 @@ static int ael2020_setup_twinax_edc(struct cphy *phy, int modtype)
 		{ 0, 0, 0, 0 }
 	};
 
+#ifdef REMOVE_DFSG
 	/* TWINAX EDC firmware */
 	static u16 twinax_edc[] = {
 		0xd800, 0x4009,
@@ -1600,6 +1605,7 @@ static int ael2020_setup_twinax_edc(struct cphy *phy, int modtype)
 		0xd989, 0x1002,
 		0xd98a, 0x0000,
 	};
+#endif /* REMOVE_DFSG */
 	int i, err;
 
 	/* set uC clock and activate it */
-- 
1.6.3.3

