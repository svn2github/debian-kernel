Subject: mips-remove-smp-reserve-lock.patch
From: Thomas Gleixner <tglx@linutronix.de>
Date: Tue, 22 May 2012 21:15:10 +0200

Instead of making the lock raw, remove it as it protects nothing.

Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
Cc: stable-rt@vger.kernel.org
---
 arch/mips/cavium-octeon/smp.c |    6 ------
 1 file changed, 6 deletions(-)

Index: linux-3.4/arch/mips/cavium-octeon/smp.c
===================================================================
--- linux-3.4.orig/arch/mips/cavium-octeon/smp.c
+++ linux-3.4/arch/mips/cavium-octeon/smp.c
@@ -257,8 +257,6 @@ DEFINE_PER_CPU(int, cpu_state);
 
 extern void fixup_irqs(void);
 
-static DEFINE_SPINLOCK(smp_reserve_lock);
-
 static int octeon_cpu_disable(void)
 {
 	unsigned int cpu = smp_processor_id();
@@ -266,8 +264,6 @@ static int octeon_cpu_disable(void)
 	if (cpu == 0)
 		return -EBUSY;
 
-	spin_lock(&smp_reserve_lock);
-
 	set_cpu_online(cpu, false);
 	cpu_clear(cpu, cpu_callin_map);
 	local_irq_disable();
@@ -277,8 +273,6 @@ static int octeon_cpu_disable(void)
 	flush_cache_all();
 	local_flush_tlb_all();
 
-	spin_unlock(&smp_reserve_lock);
-
 	return 0;
 }
 
