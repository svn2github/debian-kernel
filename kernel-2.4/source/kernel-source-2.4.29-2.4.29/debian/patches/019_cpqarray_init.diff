# origin: Debian (herbert)
# cset: n/a
# inclusion: superseded by 085
# description: superseded by 085
# revision date: 2004-09-04

diff -urN kernel-source-2.4.26/drivers/block/cpqarray.c kernel-source-2.4.26-1/drivers/block/cpqarray.c
--- kernel-source-2.4.26/drivers/block/cpqarray.c	2004-02-19 00:36:31.000000000 +1100
+++ kernel-source-2.4.26-1/drivers/block/cpqarray.c	2004-02-22 20:28:13.000000000 +1100
@@ -331,14 +331,6 @@
 MODULE_PARM(eisa, "1-8i");
 EXPORT_NO_SYMBOLS;
 
-/* This is a bit of a hack... */
-int __init init_cpqarray_module(void)
-{
-	if (cpqarray_init() == 0) /* all the block dev numbers already used */
-		return -ENODEV;	  /* or no controllers were found */
-	return 0;
-}
-
 static void release_io_mem(ctlr_info_t *c)
 {
 	/* if IO mem was not protected do nothing */
@@ -2467,6 +2459,18 @@
 
 }
 
+/* This is a bit of a hack... */
+int __init init_cpqarray_module(void)
+{
+	if (cpqarray_init() == 0) {
+		/* all the block dev numbers already used
+		 * or no controllers were found */
+        	pci_unregister_driver(&cpqarray_pci_driver);
+		return -ENODEV;	 
+	}
+	return 0;
+}
+
 static void __exit cleanup_cpqarray_module(void)
 {
         int i;
